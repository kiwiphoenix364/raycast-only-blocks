let repeat = 0
let num = 0
let dis = 0
let test1 = 0
let LeftPos = 0
tiles.setCurrentTilemap(tilemap`level1`)
let mySprite = sprites.create(img`
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    `, SpriteKind.Player)
let Detector = sprites.create(img`
    2 
    `, SpriteKind.Player)
let FOV = 1
controller.moveSprite(mySprite)
let render_dis = 100
game.onUpdate(function () {
    scene.setBackgroundImage(img`
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        `)
    LeftPos += controller.player2.dx(400)
    for (let index = 0; index <= 159; index++) {
        test1 = dis
        dis += -64
        for (let index2 = 0; index2 < 8; index2++) {
            if (!(tiles.tileAtLocationEquals(tiles.getTileLocation((mySprite.x + Math.cos((LeftPos + index * FOV) / 200) * dis) / 16, (mySprite.y + Math.sin((LeftPos + index * FOV) / 200) * dis) / 16), assets.tile`transparency16`))) {
                for (let index2 = 0; index2 <= 15; index2++) {
                    if (!(tiles.tileAtLocationEquals(tiles.getTileLocation((mySprite.x + Math.cos((LeftPos + index * FOV) / 200) * dis) / 16, (mySprite.y + Math.sin((LeftPos + index * FOV) / 200) * dis) / 16), assets.tile`transparency16`))) {
                        num = Math.map(dis * Math.tan(FOV / 400) * 200, 0, render_dis * 16, 60, 0)
                        for (let index3 = 0; index3 <= 60 + num * num / 80 - (60 - num * num / 80); index3++) {
                            scene.backgroundImage().setPixel(index, 60 - num * num / 80 + index3, tiles.tileImageAtLocation(tiles.getTileLocation((mySprite.x + Math.cos((LeftPos + index * FOV) / 200) * dis) / 16, (mySprite.y + Math.sin((LeftPos + index * FOV) / 200) * dis) / 16)).getPixel((mySprite.x + Math.cos((LeftPos + index * FOV) / 200) * dis + (mySprite.y + Math.sin((LeftPos + index * FOV) / 200) * dis)) % 16, index3 / ((60 + num * num / 80 - (60 - num * num / 80)) / 16)))
                        }
                        dis = test1
                        index += 1
                    }
                }
            } else {
                dis += 16
            }
        }
        dis = 0
        repeat = render_dis
        for (let index2 = 0; index2 < repeat; index2++) {
            if (!(tiles.tileAtLocationEquals(tiles.getTileLocation((mySprite.x + Math.cos((LeftPos + index * FOV) / 200) * dis) / 16, (mySprite.y + Math.sin((LeftPos + index * FOV) / 200) * dis) / 16), assets.tile`transparency16`))) {
                for (let index2 = 0; index2 <= 15; index2++) {
                    if (!(tiles.tileAtLocationEquals(tiles.getTileLocation((mySprite.x + Math.cos((LeftPos + index * FOV) / 200) * dis) / 16, (mySprite.y + Math.sin((LeftPos + index * FOV) / 200) * dis) / 16), assets.tile`transparency16`))) {
                        num = Math.map(dis * Math.tan(FOV / 400) * 200, 0, render_dis * 16, 60, 0)
                        for (let index3 = 0; index3 <= 60 + num * num / 80 - (60 - num * num / 80); index3++) {
                            scene.backgroundImage().setPixel(index, 60 - num * num / 80 + index3, tiles.tileImageAtLocation(tiles.getTileLocation((mySprite.x + Math.cos((LeftPos + index * FOV) / 200) * dis) / 16, (mySprite.y + Math.sin((LeftPos + index * FOV) / 200) * dis) / 16)).getPixel((mySprite.x + Math.cos((LeftPos + index * FOV) / 200) * dis + (mySprite.y + Math.sin((LeftPos + index * FOV) / 200) * dis)) % 16, index3 / ((60 + num * num / 80 - (60 - num * num / 80)) / 16)))
                        }
                        repeat = 0
                        break;
                    }
                }
            } else {
                dis += 16
            }
        }
    }
})

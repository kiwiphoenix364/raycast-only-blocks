let repeat = 0
let num = 0
let ypos = 0
let xpos = 0
let dis = 0
let test1 = 0
let LeftPos = 0
tiles.setCurrentTilemap(tilemap`level1`)
let mySprite = sprites.create(img`
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 
    `, SpriteKind.Player)
let Detector = sprites.create(img`
    2 
    `, SpriteKind.Player)
let FOV = 1
controller.moveSprite(mySprite)
let render_dis = 23
game.onUpdate(function () {
    scene.setBackgroundImage(img`
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        `)
    LeftPos += controller.player2.dx(400)
    for (let index = 0; index <= 159; index++) {
        test1 = dis
        dis += -32
        for (let index2 = 0; index2 < 4; index2++) {
            if (!(tiles.tileAtLocationEquals(tiles.getTileLocation(Math.round((mySprite.x + Math.cos((LeftPos + index * FOV) / 200) * dis) / 16), Math.round((mySprite.y + Math.sin((LeftPos + index * FOV) / 200) * dis) / 16)), assets.tile`transparency16`))) {
                for (let index2 = 0; index2 <= 15; index2++) {
                    xpos = (mySprite.x + Math.cos((LeftPos + index * FOV) / 200) * dis) / 16
                    ypos = (mySprite.y + Math.sin((LeftPos + index * FOV) / 200) * dis) / 16
                    if (!(tiles.tileAtLocationEquals(tiles.getTileLocation(xpos, ypos), assets.tile`transparency16`))) {
                        num = Math.map(dis * Math.tan(FOV / 400) * 200, 0, render_dis * 16, 60, 0)
                        scene.backgroundImage().drawLine(index, 60 - num * num / 60, index, 60 + num * num / 60, xpos + ypos)
                        dis = test1
                        index += 1
                    }
                }
            } else {
                dis += 16
            }
        }
        dis = 0
        repeat = render_dis
        for (let index2 = 0; index2 < repeat; index2++) {
            if (!(tiles.tileAtLocationEquals(tiles.getTileLocation(Math.round((mySprite.x + Math.cos((LeftPos + index * FOV) / 200) * dis) / 16), Math.round((mySprite.y + Math.sin((LeftPos + index * FOV) / 200) * dis) / 16)), assets.tile`transparency16`))) {
                for (let index2 = 0; index2 <= 15; index2++) {
                    xpos = (mySprite.x + Math.cos((LeftPos + index * FOV) / 200) * dis) / 16
                    ypos = (mySprite.y + Math.sin((LeftPos + index * FOV) / 200) * dis) / 16
                    if (!(tiles.tileAtLocationEquals(tiles.getTileLocation(xpos, ypos), assets.tile`transparency16`))) {
                        num = Math.map(dis * Math.tan(FOV / 400) * 200, 0, render_dis * 16, 60, 0)
                        scene.backgroundImage().drawLine(index, 60 - num * num / 60, index, 60 + num * num / 60, xpos + ypos)
                        repeat = 0
                        break;
                    }
                }
            } else {
                dis += 16
            }
        }
    }
})
